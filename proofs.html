<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Submit Proof</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg: #0b1020;
  --card: #11172a;
  --border: #1e2642;
  --text: #e6ebff;
  --muted: #9aa4d8;
  --accent: #22c55e;
  --danger: #ef4444;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background: radial-gradient(circle at top, #121a3a, #070b18);
  color: var(--text);
}

.nav {
  display: flex;
  gap: 20px;
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
}

.nav a {
  color: var(--muted);
  text-decoration: none;
  font-weight: 500;
}

.nav a.active {
  color: var(--accent);
}

.wrapper {
  max-width: 420px;
  margin: 40px auto;
  padding: 20px;
}

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
}

h2 {
  margin: 0 0 6px;
}

p {
  margin: 0 0 18px;
  color: var(--muted);
  font-size: 14px;
}

label {
  display: block;
  margin-top: 14px;
  font-size: 13px;
  color: var(--muted);
}

input, select {
  width: 100%;
  margin-top: 6px;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #0d1326;
  color: var(--text);
}

button {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--accent);
  background: transparent;
  color: var(--accent);
  font-weight: 600;
  cursor: pointer;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.error {
  margin-top: 12px;
  color: var(--danger);
  font-size: 13px;
}

.success {
  margin-top: 12px;
  color: var(--accent);
  font-size: 13px;
}
</style>
</head>

<body>

<div class="nav">
  <a href="index.html">Tasks</a>
  <a href="habits.html">Habits</a>
  <a href="proofs.html" class="active">Proofs</a>
</div>

<div class="wrapper">
  <div class="card">
    <h2>Evidence Submission</h2>
    <p>Upload proof for completed work.</p>

    <label>What is this proof for?</label>
    <input id="taskRef" placeholder="Describe the task" />

    <label>Where does this task belong?</label>
    <select id="source">
      <option value="checklist">Checklist</option>
      <option value="delegation">Delegation</option>
      <option value="admin">Admin</option>
    </select>

    <label>How do you prove it?</label>
    <input type="file" id="file" accept="image/*" />

    <button id="submitBtn">Submit Evidence</button>

    <div id="msg" class=""></div>
  </div>
</div>

<script>
const WORKER_URL = "https://entirenewwrker.rkknitfabsachin.workers.dev/";
const USER_EMAIL = localStorage.getItem("userEmail") || "rkknitfabsachin@gmail.com";

const btn = document.getElementById("submitBtn");
const msg = document.getElementById("msg");

btn.onclick = async () => {
  msg.textContent = "";
  msg.className = "";

  const taskRef = document.getElementById("taskRef").value.trim();
  const source = document.getElementById("source").value;
  const file = document.getElementById("file").files[0];

  if (!taskRef || !file) {
    msg.textContent = "All fields are required";
    msg.className = "error";
    return;
  }

  btn.disabled = true;

  const reader = new FileReader();
  reader.onload = async () => {
    try {
      const payload = {
        action: "uploadProof",
        email: USER_EMAIL,
        taskRef,
        source,
        imageUrl: reader.result
      };

      const res = await fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!data.success) throw data.error || "FAILED";

      msg.textContent = "Evidence uploaded successfully";
      msg.className = "success";
      document.getElementById("taskRef").value = "";
      document.getElementById("file").value = "";

    } catch (err) {
      msg.textContent = String(err);
      msg.className = "error";
    } finally {
      btn.disabled = false;
    }
  };

  reader.readAsDataURL(file);
};
</script>

</body>
</html>
