<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Proofs</title>

<style>
:root{
  --radius:18px;
  --blur:18px;
}

body.dark{
  --bg1:#020617;
  --bg2:#030b1a;
  --panel:rgba(255,255,255,.05);
  --border:rgba(255,255,255,.12);
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#22c55e;
}
body.light{
  --bg1:#f4faf7;
  --bg2:#eaf4ef;
  --panel:#ffffff;
  --border:#d6eadc;
  --text:#0f2e1c;
  --muted:#4d6b5a;
  --accent:#16a34a;
}

body{
  margin:0;
  min-height:100vh;
  font-family:Inter,system-ui;
  background:
    radial-gradient(1000px 500px at top,var(--bg2),transparent),
    linear-gradient(to bottom,var(--bg1),#020617);
  color:var(--text);
}

nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px 22px;
  backdrop-filter:blur(var(--blur));
  border-bottom:1px solid var(--border);
}

nav a{
  color:var(--muted);
  text-decoration:none;
  margin-right:16px;
}
nav a.active{
  color:var(--accent);
  border-bottom:2px solid var(--accent);
  padding-bottom:6px;
}

.toggle{
  width:42px;
  height:22px;
  border-radius:999px;
  background:var(--border);
  position:relative;
  cursor:pointer;
}
.toggle::after{
  content:"";
  position:absolute;
  top:3px; left:3px;
  width:16px; height:16px;
  border-radius:50%;
  background:var(--accent);
}
body.light .toggle::after{ left:23px }

.container{
  max-width:520px;
  margin:36px auto;
  padding:0 18px;
}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:18px;
}

label{
  display:block;
  font-size:13px;
  color:var(--muted);
  margin-bottom:6px;
}
input,select{
  width:100%;
  padding:14px;
  border-radius:14px;
  background:transparent;
  border:1px solid var(--border);
  color:var(--text);
  margin-bottom:14px;
}
button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid var(--accent);
  background:transparent;
  color:var(--accent);
  font-weight:600;
}

.status{
  margin-top:14px;
  font-size:13px;
}
.success{ color:var(--accent) }
.error{ color:#ef4444 }
</style>
</head>

<body class="dark">

<nav>
  <div>
    <a href="index.html">Tasks</a>
    <a href="habits.html">Habits</a>
    <a href="proofs.html" class="active">Proofs</a>
  </div>
  <div class="toggle" onclick="toggleTheme()"></div>
</nav>

<div class="container">

  <div class="card">
    <h3>Evidence Submission</h3>
    <p style="color:var(--muted);font-size:14px">
      Upload proof for completed work.
    </p>
  </div>

  <div class="card">
    <label>What is this proof for?</label>
    <input id="taskRef" placeholder="Task reference" />

    <label>Where does this task belong?</label>
    <select id="source">
      <option value="checklist">Checklist</option>
      <option value="delegation">Delegation</option>
      <option value="habit">Habit</option>
    </select>

    <label>How do you prove it?</label>
    <input type="file" id="file" accept="image/*" />

    <button onclick="uploadProof()">Submit Evidence</button>
    <div id="status" class="status"></div>
  </div>

</div>

<script>
/* ================= CONFIG ================= */
const WORKER_URL = "https://entirenewwrker.rkknitfabsachin.workers.dev/";

/* ðŸ”´ THIS MUST MATCH YOUR WORKER */
const ACTION_UPLOAD_PROOF = "uploadProof"; 
// If your worker expects a different name,
// change ONLY this line.

/* ================= THEME ================= */
function toggleTheme(){
  document.body.classList.toggle("light");
  document.body.classList.toggle("dark");
}

/* ================= EMAIL ================= */
function getUserEmail(){
  let email = localStorage.getItem("userEmail");
  if (!email) {
    email = prompt("Enter your work email");
    if (email) localStorage.setItem("userEmail", email.trim());
  }
  return email;
}

/* ================= UPLOAD ================= */
function uploadProof(){
  const taskRef = document.getElementById("taskRef").value.trim();
  const source  = document.getElementById("source").value;
  const file    = document.getElementById("file").files[0];
  const status  = document.getElementById("status");
  const email   = getUserEmail();

  if (!email || !taskRef || !file) {
    status.textContent = "Email, task and image are required.";
    status.className = "status error";
    return;
  }

  const reader = new FileReader();
  reader.onload = async () => {
    try {
      const res = await fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          action: ACTION_UPLOAD_PROOF,
          email,
          taskRef,
          source,
          file: reader.result
        })
      });

      const json = await res.json();

      if (json.success) {
        status.textContent = "Evidence saved successfully.";
        status.className = "status success";
        document.getElementById("file").value = "";
      } else {
        status.textContent = json.error || "Upload failed.";
        status.className = "status error";
      }
    } catch (e) {
      status.textContent = "Network error.";
      status.className = "status error";
    }
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
