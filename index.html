<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Today â€¢ Tasks</title>

<style>
/* =========================
   ðŸŒ¿ RAINFOREST THEME TOKENS
========================= */
:root{
  --bg:#020617;
  --bg-soft:#04110a;
  --panel:rgba(255,255,255,0.05);
  --border:rgba(255,255,255,0.12);

  --text:#e6f4ea;
  --muted:#9fb7a7;

  --accent:#22c55e;
  --accent-soft:rgba(34,197,94,0.15);
}

:root[data-theme="light"]{
  --bg:#f3faf6;
  --bg-soft:#e8f5ec;
  --panel:#ffffff;
  --border:#d6eadc;

  --text:#0f2e1c;
  --muted:#4d6b5a;

  --accent:#15803d;
  --accent-soft:rgba(21,128,61,0.12);
}

/* =========================
   BASE
========================= */
*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,system-ui;
  background:
    radial-gradient(1200px 600px at top, var(--bg-soft), transparent),
    var(--bg);
  color:var(--text);
}

/* =========================
   NAVBAR
========================= */
nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 18px;
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(14px);
}

nav .left{
  display:flex;
  gap:18px;
  font-weight:500;
}

nav a{
  text-decoration:none;
  color:var(--muted);
}
nav a.active{
  color:var(--text);
  border-bottom:2px solid var(--accent);
  padding-bottom:6px;
}

.theme-toggle{
  background:none;
  border:1px solid var(--border);
  border-radius:999px;
  padding:6px 10px;
  cursor:pointer;
  color:var(--accent);
}

/* =========================
   LAYOUT
========================= */
.container{
  max-width:520px;
  margin:28px auto 60px;
  padding:0 16px;
}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:20px;
  padding:18px;
  margin-bottom:16px;
}

/* =========================
   HERO
========================= */
.hero small{
  color:var(--accent);
  font-weight:600;
  letter-spacing:.04em;
}
.hero h2{
  margin:6px 0;
}
.hero p{
  margin:0;
  color:var(--muted);
}

/* =========================
   SECTIONS
========================= */
.section-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.section-title h3{
  margin:0;
}
.streak{
  font-size:12px;
  color:var(--accent);
  background:var(--accent-soft);
  padding:4px 10px;
  border-radius:999px;
}

/* =========================
   TASKS
========================= */
.task{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-radius:16px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.03);
  margin-bottom:10px;
}

.task-title{
  font-weight:500;
}
.task-meta{
  font-size:12px;
  color:var(--muted);
}

.done-btn{
  background:none;
  border:1px solid var(--border);
  color:var(--accent);
  border-radius:999px;
  padding:6px 14px;
  cursor:pointer;
}
.done-btn:hover{
  background:var(--accent-soft);
}
.done-btn:disabled{
  opacity:.5;
  cursor:default;
}

.empty{
  text-align:center;
  color:var(--muted);
  padding:10px 0;
}
</style>
</head>

<body>

<!-- NAV -->
<nav>
  <div class="left">
    <a class="active" href="index.html">Tasks</a>
    <a href="habits.html">Habits</a>
    <a href="proofs.html">Proofs</a>
  </div>
  <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ¿</button>
</nav>

<div class="container">

  <!-- HERO -->
  <div class="card hero">
    <small>TODAY</small>
    <h2>Work like the forest grows</h2>
    <p>Quiet, consistent progress compounds.</p>
  </div>

  <!-- CHECKLIST -->
  <div class="card">
    <div class="section-title">
      <h3>Checklist</h3>
      <div class="streak">Daily rhythm</div>
    </div>
    <div id="checklist"></div>
  </div>

  <!-- DELEGATION -->
  <div class="card">
    <div class="section-title">
      <h3>Delegation</h3>
    </div>
    <div id="delegation"></div>
  </div>

</div>

<script>
/* =========================
   THEME
========================= */
function applyTheme(){
  document.documentElement.dataset.theme =
    localStorage.getItem("theme") || "dark";
}
function toggleTheme(){
  const t = localStorage.getItem("theme")==="dark"?"light":"dark";
  localStorage.setItem("theme",t);
  applyTheme();
}
applyTheme();

/* =========================
   CONFIG
========================= */
const WORKER_URL="https://entirenewwrker.rkknitfabsachin.workers.dev/";
const EMAIL="rkknitfabsachin@gmail.com";

/* =========================
   LOAD TASKS
========================= */
function loadTasks(){
  fetch(WORKER_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      action:"getTodayTasks",
      email:EMAIL
    })
  })
  .then(r=>r.json())
  .then(res=>{
    const cl=document.getElementById("checklist");
    const dl=document.getElementById("delegation");

    const checklist=res.tasks.filter(t=>t.source==="checklist");
    const delegation=res.tasks.filter(t=>t.source==="delegation");

    cl.innerHTML = checklist.length
      ? checklist.map(renderTask).join("")
      : `<div class="empty">All clear ðŸŒ±</div>`;

    dl.innerHTML = delegation.length
      ? delegation.map(renderTask).join("")
      : `<div class="empty">No delegated work today</div>`;
  });
}

function renderTask(t){
  return `
    <div class="task">
      <div>
        <div class="task-title">${t.task}</div>
        <div class="task-meta">${t.source}</div>
      </div>
      <button class="done-btn"
        data-task="${encodeURIComponent(t.task)}"
        data-source="${t.source}"
        data-planned="${t.planned||""}"
        onclick="markDone(this)">
        Done
      </button>
    </div>
  `;
}

/* =========================
   MARK DONE (UNCHANGED LOGIC)
========================= */
function markDone(btn){
  const payload={
    action:"markTaskDone",
    email:EMAIL,
    source:btn.dataset.source,
    taskRef:decodeURIComponent(btn.dataset.task)
  };
  if(payload.source==="checklist" && btn.dataset.planned){
    payload.planned=btn.dataset.planned;
  }

  btn.disabled=true;
  btn.textContent="Savingâ€¦";

  fetch(WORKER_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify(payload)
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.success) loadTasks();
    else alert("Failed");
  });
}

loadTasks();
</script>

</body>
</html>
